{% load compress %}
{% if user.is_authenticated %}
<a href="{% url 'user-profile' %}" class="btn btn-empty">{{ user }}</a>
<a href="{% url 'logout' %}" class="btn">Выйти</a>
{% else %}
    <span id="ajax-login-button" class="btn btn-empty">Войти</span>
    <span id="login-form-block"></span>
    <a href="{% url 'signup' %}" class="btn btn-empty">Зарегистрироваться</a>
{% endif %}

{% compress js %}
<script>
$(function () {
$('#ajax-login-button').click(function(e){
    var loginForm = $("#ajax-login-form");
    if (loginForm.length > 0) {
    $('#login-form-block').html('');
    }
    else {
    $.ajax({
                        type: 'POST',
                        url: '{% url 'get-ajax-login-form' %}',
                        success: function (data) {
                            $('#login-form-block').html(data);
                        },
                        error: function (data) {

                        }
                    });

}
});


$(document).on('submit', '#ajax-login-form', function(e){

    var loginForm = $('#ajax-login-form');

$.ajax({
                        type: 'POST',
                        data: loginForm.serialize(),
                        url: "{% url 'ajax-login' %}",
                        success: function (data) {
                        window.location.href = location.href;
                        },
                        error: function (data) {
                        $('#login-form-block').html(data.responseJSON.html);
                        }
                    });


e.preventDefault();



});

});


</script>
{% endcompress %}